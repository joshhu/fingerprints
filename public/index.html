<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FingerprintJS V4 æŒ‡ç´‹æ¡é›†æ¸¬è©¦</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- FingerprintJS V4 å¤šé‡è¼‰å…¥æ–¹æ¡ˆ -->
    <script>
        // FingerprintJS è¼‰å…¥ç®¡ç†å™¨
        class FingerprintLoader {
            constructor() {
                this.loaded = false;
                this.loading = false;
                this.loadPromise = null;
            }
            
            async load() {
                if (this.loaded) return true;
                if (this.loading) return this.loadPromise;
                
                this.loading = true;
                this.loadPromise = this.tryLoadSources();
                return this.loadPromise;
            }
            
            async tryLoadSources() {
                const sources = [
                    'lib/fingerprintjs.min.js', // æœ¬åœ°ç‰ˆæœ¬å„ªå…ˆ
                    'https://openfpcdn.io/fingerprintjs/v4/iife.min.js',
                    'https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@4/dist/fp.min.js',
                    'https://unpkg.com/@fingerprintjs/fingerprintjs@4/dist/fp.min.js'
                ];
                
                for (let i = 0; i < sources.length; i++) {
                    const src = sources[i];
                    console.log(`å˜—è©¦è¼‰å…¥ FingerprintJS ä¾†æº ${i + 1}/${sources.length}: ${src}`);
                    
                    try {
                        await this.loadScript(src, 10000); // 10ç§’è¶…æ™‚
                        if (typeof FingerprintJS !== 'undefined') {
                            console.log('FingerprintJS è¼‰å…¥æˆåŠŸ:', src);
                            this.loaded = true;
                            return true;
                        }
                    } catch (error) {
                        console.warn(`è¼‰å…¥å¤±æ•— ${src}:`, error.message);
                        continue;
                    }
                }
                
                throw new Error('æ‰€æœ‰ FingerprintJS è¼‰å…¥ä¾†æºéƒ½å¤±æ•—');
            }
            
            loadScript(src, timeout = 10000) {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    const timeoutId = setTimeout(() => {
                        script.remove();
                        reject(new Error(`è¼‰å…¥è¶…æ™‚: ${src}`));
                    }, timeout);
                    
                    script.onload = () => {
                        clearTimeout(timeoutId);
                        resolve();
                    };
                    
                    script.onerror = () => {
                        clearTimeout(timeoutId);
                        script.remove();
                        reject(new Error(`è¼‰å…¥éŒ¯èª¤: ${src}`));
                    };
                    
                    script.src = src;
                    script.crossOrigin = 'anonymous';
                    document.head.appendChild(script);
                });
            }
        }
        
        // å…¨åŸŸè¼‰å…¥å™¨å¯¦ä¾‹
        window.fingerprintLoader = new FingerprintLoader();
        
        // æª¢æŸ¥ FingerprintJS è¼‰å…¥ç‹€æ…‹
        window.addEventListener('load', () => {
            console.log('é é¢è¼‰å…¥å®Œæˆ');
            console.log('FingerprintJS ç‹€æ…‹:', typeof FingerprintJS !== 'undefined' ? 'å·²è¼‰å…¥' : 'æœªè¼‰å…¥');
        });
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="title-section">
                    <h1>FingerprintJS V4 æŒ‡ç´‹æ¡é›†æ¸¬è©¦</h1>
                    <p>ä½¿ç”¨å°ˆæ¥­ç´šç€è¦½å™¨æŒ‡ç´‹è­˜åˆ¥æŠ€è¡“</p>
                </div>
                <div class="user-section" id="userSection">
                    <div id="currentUserDisplay" class="user-info" style="display: none;">
                        <h4>ç›®å‰ä½¿ç”¨è€…</h4>
                        <p id="currentUserName">--</p>
                        <button id="logoutTopBtn" class="logout-btn">ç™»å‡º</button>
                    </div>
                    <div id="guestUserDisplay" class="guest-info">
                        <p>æœªç™»å…¥ç‹€æ…‹</p>
                    </div>
                </div>
            </div>
        </header>

        <div class="user-status" id="userStatus">
            <span id="userStatusText">æº–å‚™æ¡é›†æŒ‡ç´‹...</span>
        </div>

        <div class="controls">
            <button id="collectBtn" class="btn btn-primary">é–‹å§‹æ¡é›†æŒ‡ç´‹</button>
            <button id="clearBtn" class="btn btn-secondary">æ¸…é™¤çµæœ</button>
            <button id="toggleAuthBtn" class="btn btn-secondary">ç”¨æˆ¶ç™»å…¥/è¨»å†Š</button>
            <button id="logoutBtn" class="btn btn-secondary" style="display: none;">ç™»å‡º</button>
        </div>

        <div class="result-container">
            <h2>æ¡é›†åˆ°çš„æŒ‡ç´‹è³‡æ–™</h2>
            
            <!-- FingerprintJS V4 çµæœ -->
            <div class="fingerprintjs-section">
                <h3>FingerprintJS V4 çµæœ</h3>
                <div class="detail-item">
                    <label>è¨ªå®¢ ID:</label>
                    <span id="visitorId">å°šæœªæ¡é›†</span>
                </div>
                <div class="detail-item">
                    <label>ä¿¡å¿ƒåº¦:</label>
                    <span id="confidence">å°šæœªæ¡é›†</span>
                </div>
                <div class="detail-item">
                    <label>ç‰ˆæœ¬:</label>
                    <span id="version">å°šæœªæ¡é›†</span>
                </div>
                <div class="detail-item">
                    <label>æ¡é›†æ™‚é–“:</label>
                    <span id="collectionTime">å°šæœªæ¡é›†</span>
                </div>
            </div>

            <!-- ç³»çµ±è³‡è¨Š -->
            <div class="system-info-section">
                <h3>ç³»çµ±è³‡è¨Š</h3>
                <div class="detail-item">
                    <label>ä½¿ç”¨è€…ä»£ç†:</label>
                    <span id="userAgent">å°šæœªæ¡é›†</span>
                </div>
                <div class="detail-item">
                    <label>è¢å¹•è§£æåº¦:</label>
                    <span id="screenResolution">å°šæœªæ¡é›†</span>
                </div>
                <div class="detail-item">
                    <label>ç€è¦½å™¨è¦–çª—:</label>
                    <span id="viewportSize">å°šæœªæ¡é›†</span>
                </div>
                <div class="detail-item">
                    <label>æ™‚å€:</label>
                    <span id="timezone">å°šæœªæ¡é›†</span>
                </div>
                <div class="detail-item">
                    <label>èªè¨€åå¥½:</label>
                    <span id="language">å°šæœªæ¡é›†</span>
                </div>
                <div class="detail-item">
                    <label>ä½œæ¥­ç³»çµ±:</label>
                    <span id="platform">å°šæœªæ¡é›†</span>
                </div>
                <div class="detail-item">
                    <label>CPU æ ¸å¿ƒæ•¸:</label>
                    <span id="hardwareConcurrency">å°šæœªæ¡é›†</span>
                </div>
                <div class="detail-item">
                    <label>è£ç½®è¨˜æ†¶é«”:</label>
                    <span id="deviceMemory">å°šæœªæ¡é›†</span>
                </div>
            </div>

            <!-- å…ƒä»¶è©³ç´°è³‡æ–™ -->
            <div class="components-section">
                <h3>æŒ‡ç´‹å…ƒä»¶è©³ç´°è³‡æ–™</h3>
                <div class="detail-item">
                    <label>å…ƒä»¶ç¸½æ•¸:</label>
                    <span id="totalComponents">0</span>
                </div>
                <div class="detail-item">
                    <label>æˆåŠŸå…ƒä»¶:</label>
                    <span id="successfulComponents">0</span>
                </div>
                <div class="detail-item">
                    <label>å¤±æ•—å…ƒä»¶:</label>
                    <span id="failedComponents">0</span>
                </div>
                <div class="detail-item">
                    <label>å¹³å‡æ¡é›†æ™‚é–“:</label>
                    <span id="averageDuration">0ms</span>
                </div>
            </div>

            <!-- å…ƒä»¶åˆ—è¡¨ -->
            <div class="components-list">
                <h3>å…ƒä»¶åˆ—è¡¨</h3>
                <div id="componentsList" class="components-grid">
                    <!-- å…ƒä»¶å°‡åœ¨é€™è£¡å‹•æ…‹é¡¯ç¤º -->
                </div>
            </div>

            <!-- èª¿è©¦è³‡è¨Š -->
            <div class="debug-section">
                <h3>èª¿è©¦è³‡è¨Š</h3>
                <pre id="debugOutput">æº–å‚™æ¡é›†...</pre>
            </div>
        </div>
    </div>

    <!-- éš±ç§åŒæ„è¦–çª— -->
    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>éš±ç§è²æ˜</h3>
            </div>
            <div class="modal-body">
                <p>æœ¬ç¶²é ç‚ºå±•ç¤ºæ€§æ¸¬è©¦ï¼Œå°‡è‡¨æ™‚è’é›†è£ç½®èˆ‡ç€è¦½å™¨è¨­å®šï¼Œä¸å»ºç«‹æŒä¹…è­˜åˆ¥ã€ä¸ä½œè¡ŒéŠ·ï¼Œä¿å­˜ä¸é€¾ 24 å°æ™‚ï¼Œä½ æ˜¯å¦åŒæ„ï¼Ÿ</p>
            </div>
            <div class="modal-footer">
                <button id="agreeBtn" class="btn btn-primary">åŒæ„</button>
                <button id="disagreeBtn" class="btn btn-secondary">ä¸åŒæ„</button>
            </div>
        </div>
    </div>

    <!-- èªè­‰å½ˆå‡ºè¦–çª— -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ç”¨æˆ¶ç™»å…¥</h3>
                <button id="closeModal" class="close-btn">&times;</button>
            </div>
            
            <!-- ç™»å…¥è¡¨å–® -->
            <div class="auth-form" id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">ç”¨æˆ¶å/Emailï¼š</label>
                    <input type="text" id="loginUsername" placeholder="è«‹è¼¸å…¥ç”¨æˆ¶åæˆ– Email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">å¯†ç¢¼ï¼š</label>
                    <input type="password" id="loginPassword" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
                </div>
                <div class="form-group">
                    <label for="loginCaptcha">é©—è­‰ç¢¼ï¼š</label>
                    <div class="captcha-container">
                        <span id="loginCaptchaQuestion">è¼‰å…¥ä¸­...</span>
                        <input type="number" id="loginCaptcha" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ">
                        <button type="button" id="refreshLoginCaptcha" class="btn btn-small">é‡æ–°ç”Ÿæˆ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="rememberMe">
                        <span>è¨˜ä½æˆ‘ï¼ˆ30 å¤©ï¼‰</span>
                    </label>
                </div>
                <div class="form-buttons">
                    <button id="loginBtn" class="btn btn-primary">ç™»å…¥</button>
                    <button id="showRegisterBtn" class="btn btn-secondary">è¨»å†Šæ–°å¸³è™Ÿ</button>
                </div>
            </div>

            <!-- è¨»å†Šè¡¨å–® -->
            <div class="auth-form" id="registerForm" style="display: none;">
                <div class="form-group">
                    <label for="registerUsername">ç”¨æˆ¶åï¼š</label>
                    <input type="text" id="registerUsername" placeholder="è«‹è¼¸å…¥ç”¨æˆ¶åï¼ˆå¿…å¡«ï¼‰">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Emailï¼š</label>
                    <input type="email" id="registerEmail" placeholder="è«‹è¼¸å…¥ Emailï¼ˆé¸å¡«ï¼‰">
                    <small class="form-hint">å¯ç”¨æ–¼ç™»å…¥å’Œæ‰¾å›å¯†ç¢¼</small>
                </div>
                <div class="form-group">
                    <label for="registerPassword">å¯†ç¢¼ï¼š</label>
                    <input type="password" id="registerPassword" placeholder="è«‹è¼¸å…¥å¯†ç¢¼ï¼ˆè‡³å°‘ 6 å€‹å­—å…ƒï¼‰">
                </div>
                <div class="form-group">
                    <label for="confirmPassword">ç¢ºèªå¯†ç¢¼ï¼š</label>
                    <input type="password" id="confirmPassword" placeholder="è«‹å†æ¬¡è¼¸å…¥å¯†ç¢¼">
                </div>
                <div class="form-group">
                    <label for="registerCaptcha">é©—è­‰ç¢¼ï¼š</label>
                    <div class="captcha-container">
                        <span id="registerCaptchaQuestion">è¼‰å…¥ä¸­...</span>
                        <input type="number" id="registerCaptcha" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ">
                        <button type="button" id="refreshRegisterCaptcha" class="btn btn-small">é‡æ–°ç”Ÿæˆ</button>
                    </div>
                </div>
                <div class="form-buttons">
                    <button id="registerBtn" class="btn btn-primary">è¨»å†Š</button>
                    <button id="showLoginBtn" class="btn btn-secondary">å·²æœ‰å¸³è™Ÿï¼Œç™»å…¥</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• -->
    <button id="themeToggle" class="theme-toggle" aria-label="åˆ‡æ›æ·±è‰²/æ·ºè‰²ä¸»é¡Œ">
        <span class="theme-toggle-icon">ğŸŒ™</span>
    </button>

    <script src="app.js"></script>
</body>
</html>
